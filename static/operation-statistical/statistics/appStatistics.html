<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
    <link rel="stylesheet" href="../css/layui.css">
    <link rel="stylesheet" href="../css/appStatistics.css">
    <script src="../echarts.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.3.0/jquery.js"></script>
    <title>appStatistics</title>
</head>

<body>
    
    <div class="content">
       
        <div class="right">
            <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                <ul class="layui-tab-title">
                    <li onclick="defaultCard()">全部分类</li>
                    <li onclick="changeEduData()">教育类</li>
                    <li onclick="changeTeaAssit()">教辅类</li>
                    <li onclick="changeManage()">管理类</li>
                </ul>
                <hr style="margin-top: 1px;" />
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <div>
                            <div class="card">
                                <p>应用总数（个）</p>
                                <p id="appSum"></p>
                                <img src="../images/extra/u5874.png">
                            </div>
                            <div class="card">
                                <p>总下载量（次）</p>
                                <p id="downSum"></p>
                                <img src="../images/extra/u5874.png">
                            </div>
                            <div class="card">
                                <p>应用中申请（个）</p>
                                <p id="appApply"></p>
                                <img src="../images/extra/u5889.png">
                            </div>
                            <div class="card">
                                <p>用户收藏数（个）</p>
                                <p id="userColl"></p>
                                <img src="../images/extra/u5899.png">
                            </div>
                        </div>

                        <script>
                            $.get('http://192.168.1.26:52999/server/statistics/getAppliedStatisticsList',{type:'全部分类'}).done(function (data) {
                                var length=data.length-1;
                                $('#appSum').text(data[length].total);
                            })
                            $.get('http://192.168.1.26:52999/server/statistics/getAppDowmloadStatisticsList',{type:'全部分类'}).done(function (data) {
                              var downLength=data.length-1;
                              $('#downSum').text(data[downLength].total);
                            })
                            $.get('http://192.168.1.26:52999/server/statistics/getApplyStatisticsList',{type:'全部分类'}).done(function (data) {
                              var applyLength=data.length-1;
                              $('#appApply').text(data[applyLength].total);
                            })
                            $.get('http://192.168.1.26:52999/server/statistics/getCollStatisticsList',{type:'全部分类'}).done(function (data) {
                              var collLength=data.length-1;
                              $('#userColl').text(data[collLength].total);
                            })
                            function defaultCard() {
                              $.get('http://192.168.1.26:52999/server/statistics/getAppliedStatisticsList',{type:'全部分类'}).done(function (data) {
                                var length=data.length-1;
                                $('#appSum').text(data[length].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getAppDowmloadStatisticsList',{type:'全部分类'}).done(function (data) {
                                var downLength=data.length-1;
                                $('#downSum').text(data[downLength].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getApplyStatisticsList',{type:'全部分类'}).done(function (data) {
                                var applyLength=data.length-1;
                                $('#appApply').text(data[applyLength].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getCollStatisticsList',{type:'全部分类'}).done(function (data) {
                                var collLength=data.length-1;
                                $('#userColl').text(data[collLength].total);
                              })
                            }
                            function changeEduData() {
                              $.get('http://192.168.1.26:52999/server/statistics/getAppliedStatisticsList',{type:'教育类'}).done(function (data) {
                                var length=data.length-1;
                                $('#appSum').text(data[length].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getAppDowmloadStatisticsList',{type:'教育类'}).done(function (data) {
                                var downLength=data.length-1;
                                $('#downSum').text(data[downLength].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getApplyStatisticsList',{type:'教育类'}).done(function (data) {
                                var applyLength=data.length-1;
                                $('#appApply').text(data[applyLength].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getCollStatisticsList',{type:'教育类'}).done(function (data) {
                                var collLength=data.length-1;
                                $('#userColl').text(data[collLength].total);
                              })
                              
                              $('#assit').css('display','none');
                              $('#mangae').css('display','none');
                              $('#all').css('display','none');
                              $('#edu').css('display','block');
                              
                            }
                            function changeTeaAssit() {
                              $.get('http://192.168.1.26:52999/server/statistics/getAppliedStatisticsList',{type:'教辅类'}).done(function (data) {
                                var length=data.length-1;
                                $('#appSum').text(data[length].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getAppDowmloadStatisticsList',{type:'教辅类'}).done(function (data) {
                                var downLength=data.length-1;
                                $('#downSum').text(data[downLength].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getApplyStatisticsList',{type:'教辅类'}).done(function (data) {
                                var applyLength=data.length-1;
                                $('#appApply').text(data[applyLength].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getCollStatisticsList',{type:'教辅类'}).done(function (data) {
                                var collLength=data.length-1;
                                $('#userColl').text(data[collLength].total);
                              })
                              
                              $('#edu').css('display','none');
                              $('#mangae').css('display','none');
                              $('#all').css('display','none');
                              $('#assit').css('display','block');
                            }
                            function changeManage() {
                              $.get('http://192.168.1.26:52999/server/statistics/getAppliedStatisticsList',{type:'管理类'}).done(function (data) {
                                var length=data.length-1;
                                $('#appSum').text(data[length].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getAppDowmloadStatisticsList',{type:'管理类'}).done(function (data) {
                                var downLength=data.length-1;
                                $('#downSum').text(data[downLength].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getApplyStatisticsList',{type:'管理类'}).done(function (data) {
                                var applyLength=data.length-1;
                                $('#appApply').text(data[applyLength].total);
                              })
                              $.get('http://192.168.1.26:52999/server/statistics/getCollStatisticsList',{type:'管理类'}).done(function (data) {
                                var collLength=data.length-1;
                                $('#userColl').text(data[collLength].total);
                              })
                              
                              $('#assit').css('display','none');
                              $('#edu').css('display','none');
                              $('#all').css('display','none');
                              $('#mangae').css('display','block');
                            }
                        </script>


                        <div class="pie">
                            <div class="pie-left">
                                <p>应用类型占比</p>
                                <div id="apptype" style="width:500px;height:240px">
                                    <script type="text/javascript">
                                        var myChartOne = echarts.init(document.getElementById('apptype'));
                                        // 指定图表的配置项和数据
                                        var option = {
                                            tooltip: { //提示框组件
                                                trigger: 'item', //触发类型(饼状图片就是用这个)
                                                formatter: "{a} <br/>{b} : {c} ({d}%)" //提示框浮层内容格式器
                                            },
                                            // color: ['#48cda6', '#fd87ab', '#11abff', "#FFD700"], //手动设置每个图例的颜色
                                            legend: { //图例组件
                                                //right:100,  //图例组件离右边的距离
                                                orient: 'horizontal', //布局  纵向布局 图例标记居文字的左边 vertical则反之
                                                width: 40, //图行例组件的宽度,默认自适应
                                                x: 'right', //图例显示在右边
                                                y: 'center', //图例在垂直方向上面显示居中
                                                itemWidth: 10, //图例标记的图形宽度
                                                itemHeight: 10, //图例标记的图形高度
                                                // data:['60%','30%','10%'],
                                                data: [],
                                                textStyle: { //图例文字的样式
                                                    color: '#333', //文字颜色
                                                    fontSize: 13 //文字大小
                                                }
                                            },
                                            series: [ //系列列表
                                                {
                                                    name: '应用占比', //系列名称
                                                    type: 'pie', //类型 pie表示饼图
                                                    center: ['30%', '50%'], //设置饼的原心坐标 不设置就会默认在中心的位置
                                                    radius: ['50%', '70%'], //饼图的半径,第一项是内半径,第二项是外半径,内半径为0就是真的饼,不是环形
                                                    avoidLabelOverlap: false,
                                                    label: {
                                                      normal: {
                                                        show: false,
                                                        position: 'center'
                                                      },
                                                      emphasis: {
                                                        show: true,
                                                        textStyle: {
                                                          fontSize: '20',
                                                          fontWeight: 'bold'
                                                        }
                                                      }
                                                    },
                                                    labelLine: {
                                                      normal: {
                                                        show: false
                                                      }
                                                    },
                                                    data: []
                                                }
                                            ]
                                        }

                                        myChartOne.setOption(option);
                                        
                                        // var url=window.parent.document.getElementById('appCount').contentWindow.location.href;
                                        // var id=url.substring(url.indexOf('=')+1);
                                        // var newUrl='http://192.168.1.26:52999/server/getTypeStatisticsList?STAR_WEB_SESSION_ID='+id;
                                        // console.log(id);
                                        
                                        var newUrl='http://192.168.1.26:52999/server/statistics/getTypeStatisticsList';
                                        $.get(newUrl).done(function (data) {

                                            console.log(data);
                                            myChartOne.setOption(
                                                option = {
                                                    legend: {
                                                        data
                                                    },
                                                    series: [{
                                                        data
                                                    }]

                                                }
                                            )
                                        })
                                    </script>
                                </div>
                            </div>
                            <div class="pie-right">
                                <p>当月下载量占比</p>
                                <div id="appdown" style="width:500px;height:240px">
                                    <script type="text/javascript">
                                        var myChartTwo = echarts.init(document.getElementById('appdown'));

                                        var option = {
                                            tooltip: {
                                                trigger: 'item',
                                                formatter: "{a} <br/>{b} : {c} ({d}%)"
                                            },
                                            // color: ['#48cda6', '#fd87ab', '#11abff', "#FFD700"],
                                            legend: {

                                                orient: 'horizontal',
                                                width: 40,
                                                x: 'right',
                                                y: 'center',
                                                itemWidth: 10,
                                                itemHeight: 10,
                                                data: [],
                                                textStyle: {
                                                    color: '#333',
                                                    fontSize: 13
                                                }
                                            },
                                            series: [ //系列列表
                                                {
                                                    name: '下载占比',
                                                    type: 'pie',
                                                    center: ['30%', '50%'],
                                                    radius: ['50%', '70%'],
                                                    avoidLabelOverlap: false,
                                                    label: {
                                                      normal: {
                                                        show: false,
                                                        position: 'center'
                                                      },
                                                      emphasis: {
                                                        show: true,
                                                        textStyle: {
                                                          fontSize: '20',
                                                          fontWeight: 'bold'
                                                        }
                                                      }
                                                    },
                                                    labelLine: {
                                                      normal: {
                                                        show: false
                                                      }
                                                    },
                                                    data: []
                                                }
                                            ]
                                        }
                                        myChartTwo.setOption(option);
                                        // var url=window.parent.document.getElementById('appCount').contentWindow.location.href;
                                        // var id=url.substring(url.indexOf('=')+1);
                                        // var newUrl='http://192.168.1.26:52999/server/getDownloadStatisticsList?STAR_WEB_SESSION_ID='+id;
                                        var newUrl='http://192.168.1.26:52999/server/statistics/getDownloadStatisticsList'
                                        $.get(newUrl).done(function (data) {
                                            // console.log(data);
                                            myChartTwo.setOption(
                                                option = {
                                                    legend: {
                                                        data
                                                    },
                                                    series: [{
                                                        data
                                                    }]

                                                }
                                            )
                                        })
                                    </script>
                                </div>
                            </div>
                        </div>

                        <div class="table" id="all">
                            <script type="text/html" id="info">
                                <style type="text/css">
                                    .layui-badge {
                                      color: #666;
                                      border-radius:40%;
                                      background-color: #eee;
                                    }
                                    
                                </style>
                                <span class="layui-badge" style="background-color: {{d.BGCOLOR}};">{{d.id}}</span>
                                <img src="{{d.APPURL}}" style="width: 27px;height: 23px;margin: 0px 10px 0 12px;">
                                <span style="color:{{d.bgColor}};">{{d.APPNAME}}</span>
                            </script>



                            <script type="text/html" id="progross">
                                <style type="text/css">
                                    .layui-table{
                                      display: block;
                                    }
                                    
                                    .layui-progress-bar {
                                        background-color: rgba(169, 175, 203, 1);
                                    }
                                </style>
                                <span>{{d.downNum}}</span>
                                <div class="layui-progress" style="margin-left: 30px;width: 230px;display: inline-block;">
                                    <div class="layui-progress-bar {{d.STYLE}}" lay-percent="{{d.PROGORSS}}" style="width:{{d.PROGROSS}}"></div>
                                </div>
                            </script>

                            <table class="layui-table"  lay-data="{width:1107, url:'http://192.168.1.26:52999/server/statistics/getRankList',method:'get',where:{type:'全部分类'},skin: 'row', even: true}">
                                <thead>
                                    <tr>
                                        <th lay-data="{field:'app', width:188, templet:'#info',}">APP名称</th>
                                        <th lay-data="{field:'APPTYPE', width:148,}">APP类型</th>
                                        <th lay-data="{field:'DOWNLOADS', width:366, templet:'#progross',}">下载数量</th>
                                        <th lay-data="{field:'COLLNUM', width:124}">收藏数量</th>
                                        <th lay-data="{field:'CLICKNUM', width:122}">点击率</th>
                                        <th lay-data="{field:'TIME'}">上线时间</th>
                                    </tr>
                                </thead>
                            </table>
                          
                        </div>
                        <div class="table" id="edu">
                        <script type="text/html" id="info">
                          <style type="text/css">
                            .layui-badge {
                              color: #666;
                              border-radius:40%;
                              background-color: #eee;
                            }

                          </style>
                          <span class="layui-badge" style="background-color: {{d.bgColor}};">{{d.rank}}</span>
                          <img src="{{d.src}}" style="width: 27px;height: 23px;margin: 0px 10px 0 12px;">
                          <span style="color:{{d.bgColor}};">{{d.app}}</span>
                        </script>



                        <script type="text/html" id="progross">
                          <style type="text/css">
                            .layui-table{
                              display: block;
                            }

                            .layui-progress-bar {
                              background-color: rgba(169, 175, 203, 1);
                            }
                          </style>
                          <span>{{d.downNum}}</span>
                          <div class="layui-progress" style="margin-left: 30px;width: 230px;display: inline-block;">
                            <div class="layui-progress-bar {{d.style}}" lay-percent="{{d.progross}}" style="width:{{d.progross}}"></div>
                          </div>
                        </script>

                        <table class="layui-table"  lay-data="{width:1107, url:'../data.json',method:'post',where:{type:'教育类'},skin: 'row', even: true}">
                          <thead>
                          <tr>
                            <th lay-data="{field:'app', width:188, templet:'#info',}">APP名称</th>
                            <th lay-data="{field:'type', width:148,}">APP类型</th>
                            <th lay-data="{field:'downNum', width:366, templet:'#progross',}">下载数量</th>
                            <th lay-data="{field:'collNum', width:124}">收藏数量</th>
                            <th lay-data="{field:'ctr', width:122}">点击率</th>
                            <th lay-data="{field:'onlineTime'}">上线时间</th>
                          </tr>
                          </thead>
                        </table>

                      </div>
                        <div class="table" id="assit">
                        <script type="text/html" id="info">
                          <style type="text/css">
                            .layui-badge {
                              color: #666;
                              border-radius:40%;
                              background-color: #eee;
                            }

                          </style>
                          <span class="layui-badge" style="background-color: {{d.bgColor}};">{{d.rank}}</span>
                          <img src="{{d.src}}" style="width: 27px;height: 23px;margin: 0px 10px 0 12px;">
                          <span style="color:{{d.bgColor}};">{{d.app}}</span>
                        </script>



                        <script type="text/html" id="progross">
                          <style type="text/css">
                            .layui-table{
                              display: block;
                            }

                            .layui-progress-bar {
                              background-color: rgba(169, 175, 203, 1);
                            }
                          </style>
                          <span>{{d.downNum}}</span>
                          <div class="layui-progress" style="margin-left: 30px;width: 230px;display: inline-block;">
                            <div class="layui-progress-bar {{d.style}}" lay-percent="{{d.progross}}" style="width:{{d.progross}}"></div>
                          </div>
                        </script>

                        <table class="layui-table"  lay-data="{width:1107, url:'../data.json',method:'post',where:{type:'教辅类'},skin: 'row', even: true}">
                          <thead>
                          <tr>
                            <th lay-data="{field:'app', width:188, templet:'#info',}">APP名称</th>
                            <th lay-data="{field:'type', width:148,}">APP类型</th>
                            <th lay-data="{field:'downNum', width:366, templet:'#progross',}">下载数量</th>
                            <th lay-data="{field:'collNum', width:124}">收藏数量</th>
                            <th lay-data="{field:'ctr', width:122}">点击率</th>
                            <th lay-data="{field:'onlineTime'}">上线时间</th>
                          </tr>
                          </thead>
                        </table>

                      </div>
                        <div class="table" id="mangae">
                        <script type="text/html" id="info">
                          <style type="text/css">
                            .layui-badge {
                              color: #666;
                              border-radius:40%;
                              background-color: #eee;
                            }

                          </style>
                          <span class="layui-badge" style="background-color: {{d.bgColor}};">{{d.rank}}</span>
                          <img src="{{d.src}}" style="width: 27px;height: 23px;margin: 0px 10px 0 12px;">
                          <span style="color:{{d.bgColor}};">{{d.app}}</span>
                        </script>



                        <script type="text/html" id="progross">
                          <style type="text/css">

                            .layui-progress-bar {
                              background-color: rgba(169, 175, 203, 1);
                            }
                          </style>
                          <span>{{d.downNum}}</span>
                          <div class="layui-progress" style="margin-left: 30px;width: 230px;display: inline-block;">
                            <div class="layui-progress-bar {{d.style}}" lay-percent="{{d.progross}}" style="width:{{d.progross}}"></div>
                          </div>
                        </script>

                        <table class="layui-table"  lay-data="{width:1107, url:'../data.json',method:'post',where:{type:'管理类'},skin: 'row', even: true}">
                          <thead>
                          <tr>
                            <th lay-data="{field:'app', width:188, templet:'#info',}">APP名称</th>
                            <th lay-data="{field:'type', width:148,}">APP类型</th>
                            <th lay-data="{field:'downNum', width:366, templet:'#progross',}">下载数量</th>
                            <th lay-data="{field:'collNum', width:124}">收藏数量</th>
                            <th lay-data="{field:'ctr', width:122}">点击率</th>
                            <th lay-data="{field:'onlineTime'}">上线时间</th>
                          </tr>
                          </thead>
                        </table>

                      </div>
                      
                    </div>

                </div>
                
            </div>
        </div>


    </div>
    </div>
    
    <script src="../layui.js"></script>
    <script>
        layui.use(['element', 'table'], function () {
            var element = layui.element,
                table = layui.table,
                $ = layui.jquery; //导航的hover效果、二级菜单等功能，需要依赖element模块
          
        });
    </script>
</body>

</html>
